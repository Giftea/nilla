# Setup Nilla Locally

### Prerequisites

- Node.js 18+
- pnpm
- Supabase account
- OpenAI API key
- GitHub OAuth app credentials
- Resend account (optional, for emails)

### Step 1: Clone and Install Dependencies

```bash
git clone https://github.com/giftea/nilla.git
cd nilla
pnpm install
```

### Step 2: Set Up Environment Variables

Create `.env.local` and `.env` files in the root directory:

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3001

# OpenAI (required for AI features)
OPENAI_API_KEY=your-openai-api-key

# Resend (for email reminders)
RESEND_API_KEY=your-resend-api-key

# Cron Secret
CRON_SECRET=your-cron-secret

# OPIK Credentials
OPIK_URL_OVERRIDE=
OPIK_PROJECT_NAME=
OPIK_API_KEY=
OPIK_WORKSPACE=
```

### Step 3: Set Up Supabase Database

1. Create a new Supabase project
2. Run the migrations in order via the Supabase SQL editor:
   - `supabase/migrations/001_initial_schema.sql` - Main database schema
   - `supabase/migrations/002_add_stats_functions.sql` - RPC functions for stats
   - `supabase/migrations/003_add_repo_embeddings.sql` - RAG embeddings table

### Step 4: Configure GitHub OAuth

1. Go to [GitHub Developer Settings](https://github.com/settings/developers)
2. Create a new OAuth App with:
   - **Homepage URL**: `http://localhost:3001`
   - **Authorization callback URL**: `http://localhost:3001/auth/callback`
3. Copy the Client ID and Client Secret
4. In Supabase Dashboard, go to **Authentication > Providers > GitHub**
5. Enable GitHub provider and add your Client ID and Client Secret

### Step 5: Run the Development Server

```bash
pnpm dev
```

The app will be available at `http://localhost:3001`

### Available Scripts

| Command | Description |
|---------|-------------|
| `pnpm dev` | Start development server with Turbopack |
| `pnpm build` | Build for production |
| `pnpm start` | Start production server |
| `pnpm lint` | Run ESLint |

### Run Experiment Commands

| Command | Description |
|---------|-------------|
| `pnpm experiment:recommender` | Evaluate Issue Recommender agent |
| `pnpm experiment:coach` | Evaluate Commitment Coach agent |
| `pnpm experiment:explainer` | Evaluate Issue Explainer agent |

### Run Evaluation Commands

| Command | Description |
|---------|-------------|
| `pnpm eval` | Evaluate all Three Agents |

Each evaluation:
- Runs agent on 12 curated test cases
- Uses GPT-4o as LLM judge
- Generates multi-metric scores
- Creates Opik experiment with result URL
- Outputs summary to console
